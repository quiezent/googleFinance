# Financial Advisor


## Overview

The Financial Advisor is a team of specialized AI agents that assists human financial advisors.

1. Data Analyst Agent: This agent is responsible for creating in-depth and current market analysis reports for specific Bursa Malaysia (KLSE) stock tickers. It achieves this by repeatedly using Google Search to find a predetermined amount of unique, recent (within a given timeframe), and insightful information. The agent focuses on gathering Bursa Malaysia disclosures, Securities Commission Malaysia announcements, dividend calendars, and broader market intelligence via Google Search, which it then uses to compile a structured report based solely on the collected data.

2. Trading Analyst Agent: This agent's task is to develop and describe at least five different trading strategies. It does this by carefully reviewing the comprehensive market analysis provided by the Data Analyst Agent. Each proposed strategy must be customized to match the user's declared risk tolerance and intended investment duration.

3. Execution Agent: This agent creates a thorough and well-justified plan for implementing a given trading strategy. The plan must be carefully adjusted to fit the user's risk tolerance, investment timeframe, and preferred methods of execution. The output will be detailed and fact-based, examining the best approaches and specific timing for initiating, maintaining, adding to, partially selling, and completely exiting investment positions.

4. Risk Evaluation Agent: This agent's role is to produce a detailed and reasoned analysis of the risks associated with a specific trading strategy and its execution plan. This analysis needs to be precisely aligned with the user's stated risk tolerance, investment period, and execution preferences. The output will be rich in factual analysis, clearly outlining all identified risks and suggesting concrete, actionable steps to lessen their impact.

**Legal Disclaimer and User Acknowledgment**

Important Disclaimer: For Educational and Informational Purposes Only.

The information and trading strategy outlines provided by this tool, including any analysis, commentary, or potential scenarios, are generated by an AI model and are for educational and informational purposes only. They do not constitute, and should not be interpreted as, financial advice, investment recommendations, endorsements, or offers to buy or sell any securities or other financial instruments.

Google and its affiliates make no representations or warranties of any kind, express or implied, about the completeness, accuracy, reliability, suitability, or availability with respect to the information provided. Any reliance you place on such information is therefore strictly at your own risk.

This is not an offer to buy or sell any security. Investment decisions should not be made based solely on the information provided here. Financial markets are subject to risks, and past performance is not indicative of future results. You should conduct your own thorough research and consult with a qualified independent financial advisor before making any investment decisions.

By using this tool and reviewing these strategies, you acknowledge that you understand this disclaimer and agree that Google and its affiliates are not liable for any losses or damages arising from your use of or reliance on this information.

## Agent Details

The key features of the Financial Advisor include:

| Feature | Description |
| --- | --- |
| **Interaction Type** | Conversational |
| **Complexity**  | Medium |
| **Agent Type**  | Multi Agent |
| **Components**  | Tools: built-in Google Search |
| **Vertical**  | Financial |


### Agent architecture:

This diagram shows the detailed architecture of the agents and tools used
to implement this workflow.
<img src="financial-advisor.png" alt="Financial Advisor" width="800"/>

## Setup and Installation

1.  **Prerequisites**

    *   Python 3.11+
    *   Poetry
        *   For dependency management and packaging. Please follow the
            instructions on the official
            [Poetry website](https://python-poetry.org/docs/) for installation.

        ```bash
        pip install poetry
        ```

    * A project on Google Cloud Platform
    * Google Cloud CLI
        *   For installation, please follow the instruction on the official
            [Google Cloud website](https://cloud.google.com/sdk/docs/install).

2.  **Installation**

    ```bash
    # Clone this repository.
    git clone https://github.com/google/adk-samples.git
    cd adk-samples/python/agents/financial_advisor
    # Install the package and dependencies.
    # Note for Linux users: If you get an error related to `keyring` during the installation, you can disable it by running the following command:
    # poetry config keyring.enabled false
    # This is a one-time setup.
    poetry install
    ```

3.  **Configuration**

    *   Set up Google Cloud credentials.

        *   You may set the following environment variables in your shell, or in
            a `.env` file instead.

        ```bash
        export GOOGLE_GENAI_USE_VERTEXAI=true
        export GOOGLE_CLOUD_PROJECT=<your-project-id>
        export GOOGLE_CLOUD_LOCATION=<your-project-location>
        export GOOGLE_CLOUD_STORAGE_BUCKET=<your-storage-bucket>  # Only required for deployment on Agent Engine
        ```

    *   Authenticate your GCloud account.

        ```bash
        gcloud auth application-default login
        gcloud auth application-default set-quota-project $GOOGLE_CLOUD_PROJECT
        ```

## Running the Agent

**Using `adk`**

ADK provides convenient ways to bring up agents locally and interact with them.
You may talk to the agent using the CLI:

```bash
adk run financial_advisor
```

Or on a web interface:

```bash
 adk web
```

The command `adk web` will start a web server on your machine and print the URL.
You may open the URL, select "financial_advisor" in the top-left drop-down menu, and
a chatbot interface will appear on the right. The conversation is initially
blank. Here are some example requests you may ask the Financial Advisor to verify:

```
who are you
```

Sampled responses of these requrests are shown below in the [Example
Interaction](#example-interaction) section.

```
I am the financial coordinator agent. My role is to guide you through a structured process to receive financial advice. I work with specialized subagents to help you:

Analyze a market ticker.
Develop trading strategies based on your risk profile and investment goals.
Define an optimal plan for executing those strategies.
Evaluate the overall risk of the proposed plan.
How can I help you start this process today? For example, we could begin by analyzing a market ticker.

```

### Example Interaction

Below is an example interaction with the Financial Advisor. Note that the exact output
of the agent may be different every time.

```

User: who are you

I am the financial coordinator agent. My role is to guide you through a structured process to receive financial advice. I work with specialized subagents to help you:

Analyze a market ticker.
Develop trading strategies based on your risk profile and investment goals.
Define an optimal plan for executing those strategies.
Evaluate the overall risk of the proposed plan.
How can I help you start this process today? For example, we could begin by analyzing a market ticker.

User: MAYBNK

It looks like there might be a typo in the ticker symbol. Did you mean "MAYBANK" for Malayan Banking Berhad (ticker 1155.KL on Bursa Malaysia)?

Once you confirm the correct ticker symbol, I will start the first step by calling the data_analyst subagent to gather comprehensive market data analysis for it.

User: correct

Okay, great. I will now call the data_analyst subagent to gather comprehensive market data analysis for the ticker symbol MAYBANK (1155.KL).

This analysis will cover recent Bursa Malaysia announcements, Securities Commission Malaysia notices, dividend and corporate action calendars, regional financial news, market sentiment, analyst outlooks, and notable price or volume movements.

Okay, the data_analyst subagent has outlined its plan to gather comprehensive market data for MAYBANK. It will look into Bursa Malaysia filings, Malaysian press coverage, dividend updates, market sentiment, analyst opinions, risks, opportunities, and major events from the past 7 days.

(Note: While the tool output showed the agent's plan, for the purpose of this process, we will assume it has successfully executed this plan and returned a detailed market analysis. This analysis, covering recent disclosures, news, sentiment, and risks for MAYBANK, is now conceptually stored in our state key market_data_analysis_output.)

This market analysis provides the context we need for the next step.

Step 2: Develop Trading Strategies

Now, I need to call the trading_analyst subagent. This agent will use the market analysis for MAYBANK (market_data_analysis_output) along with your personal investment preferences to suggest potential trading strategies.

To help the trading_analyst tailor the strategies, please tell me:

What is your Risk Attitude? (e.g., conservative, moderate, aggressive)
What is your Investment Period? (e.g., short-term, medium-term, long-term)

User: risk moderate , and investment long period

Great, thank you for providing that information. Your risk attitude is moderate, and your investment period is long-term.

I will now call the trading_analyst subagent. It will use the previously gathered market analysis for MAYBANK (stored in market_data_analysis_output) along with your moderate risk profile and long-term investment horizon to develop suitable trading strategies.

Okay, the trading_analyst subagent has analyzed the market data for MAYBANK in the context of your moderate risk attitude and long-term investment period. Based on this, it has proposed five potential trading strategies for your consideration:

Dividend Capture Around Upcoming Ex-Date: Focused on accumulating shares before the next announced ex-date and exiting after the entitlement is locked in.
Core Long-Term Accumulation of Malaysian Banking Exposure: Gradually build and hold a position to benefit from Malaysia's structural banking demand and Maybank's dividend track record.
Value Averaging on Ringgit-Driven Pullbacks: Increase allocations when macro news drives the share price lower relative to book value, with disciplined rebalancing.
Covered Call Overlay for Income Stability: Sell out-of-the-money call warrants or structured products listed on Bursa Malaysia to generate additional income while holding core shares.
Regional Expansion Momentum Play: Scale in if catalysts related to ASEAN expansion, digital banking initiatives, or ESG financing pipelines trigger breakout volumes.
Each outline details the rationale, alignment with your profile, key indicators to watch (such as loan growth guidance, Bank Negara Malaysia policy moves, and Bursa trading volumes), potential entry/exit conditions, and specific risks.

(Please note the important disclaimer provided by the agent: This information is for educational purposes only and is not financial advice. Always conduct your own research and consult a qualified financial advisor before making investment decisions.)

These proposed strategies have now been conceptually stored in the state key proposed_trading_strategies_output.

Step 3: Define Optimal Execution Strategy

Next, we need to refine how one might implement these strategies. I will call the execution_analyst subagent to develop a detailed execution plan. This plan considers factors like order types, Bursa Malaysia trading sessions, potential costs, and liquidity, aligning with the strategies, your risk profile, and the market analysis.

The execution_analyst will use:

The proposed trading strategies (proposed_trading_strategies_output).
Your risk attitude (Moderate).
Your investment period (Long-term).
Before I call the agent, do you have any specific preferences regarding execution? For example:

Do you have a preferred Malaysian broker?
Are there specific order types you prefer or want to avoid (e.g., limit orders, odd-lot boards)?
Any other constraints or preferences for how trades are placed on Bursa Malaysia?
If you don't have specific preferences, the agent will suggest generally suitable approaches.

User: show me the detailed trading strategy as markdown

Okay, you'd like to see the proposed trading strategies presented in a detailed markdown format. Here they are, based on the output from the trading_analyst subagent:

Potential Trading Strategy Outlines for MAYBANK (Moderate Risk, Long-Term Horizon)
Here are five potential trading strategy outlines developed based on the market analysis for MAYBANK and your stated preferences:

Strategy 1: Dividend Capture Around Upcoming Ex-Date
Description & Rationale: Build a position ahead of the declared ex-dividend date to secure the dividend while monitoring Bursa Malaysia announcements for confirmation of entitlement timelines and withholding tax updates.
Alignment with User Profile: Suitable for a moderate risk profile seeking steady income while remaining mindful of price volatility around corporate actions.
Key Market Indicators to Watch:
- Bursa Malaysia dividend announcements and entitlement notices
- Average daily trading volume leading into the ex-date
- Bank Negara Malaysia policy statements affecting yield expectations
Potential Entry Conditions: Accumulate shares during quieter trading sessions when the bid-ask spread narrows two to three weeks before the ex-date.
Potential Exit Conditions or Targets: Trim exposure once the stock normalizes after the ex-date or if the dividend yield falls below target thresholds.
Primary Risks Specific to this Strategy: Price pullback after ex-date, revisions to dividend guidance, or liquidity drying up in the odd-lot market.

Strategy 2: Core Long-Term Accumulation of Malaysian Banking Exposure
Description & Rationale: Gradually accumulate MAYBANK shares using a ringgit-cost averaging plan to benefit from the bank's dominant market share, resilient CASA ratios, and consistent dividend policy.
Alignment with User Profile: Aligns with a moderate risk appetite that values stable income and long-term capital appreciation.
Key Market Indicators to Watch:
- Quarterly results released on Bursa Malaysia
- Loan growth, net interest margin, and credit cost trends
- Malaysian GDP and inflation prints influencing banking demand
Potential Entry Conditions: Schedule monthly or quarterly buys, with larger allocations when price-to-book approaches historical lows.
Potential Exit Conditions or Targets: Rebalance if exposure exceeds allocation limits or if structural profitability metrics deteriorate materially.
Primary Risks Specific to this Strategy: Sector-wide credit shocks, regulatory changes affecting dividend payouts, or prolonged ringgit weakness.

(Additional strategies omitted here for brevity in the README, but the live agent will surface all five detailed outlines.)

User: great , what's next

Now that we've explored potential strategies, I'll ask the execution_analyst for a detailed execution plan tailored to your moderate risk attitude and long-term horizon.

...

User: thanks

You're welcome! Remember, everything we've discussed is for educational purposes only and not financial advice. Let me know if you'd like to analyze another Bursa Malaysia ticker or revisit any part of the process.

User :you too

Thank you!
Thank you!
```

## Running Tests

For running tests and evaluation, install the extra dependencies:

```bash
poetry install --with dev
```

Then the tests and evaluation can be run from the `financial-advisor` directory using
the `pytest` module:

```bash
python3 -m pytest tests
python3 -m pytest eval
```

`tests` runs the agent on a sample request, and makes sure that every component
is functional. `eval` is a demonstration of how to evaluate the agent, using the
`AgentEvaluator` in ADK. It sends a couple requests to the agent and expects
that the agent's responses match a pre-defined response reasonably well.


## Deployment

The Financial Advisor can be deployed to Vertex AI Agent Engine using the following
commands:

```bash
poetry install --with deployment
python3 deployment/deploy.py --create
```

When the deployment finishes, it will print a line like this:

```
Created remote agent: projects/<PROJECT_NUMBER>/locations/<PROJECT_LOCATION>/reasoningEngines/<AGENT_ENGINE_ID>
```

If you forgot the AGENT_ENGINE_ID, you can list existing agents using:

```bash
python3 deployment/deploy.py --list
```

The output will be like:

```
All remote agents:

123456789 ("financial_advisor")
- Create time: 2025-05-12 12:35:34.245431+00:00
- Update time: 2025-05-12 12:36:01.421432+00:00
```

You may interact with the deployed agent using the `test_deployment.py` script
```bash
$ export USER_ID=<any string>
$ python3 deployment/test_deployment.py --resource_id=${AGENT_ENGINE_ID} --user_id=${USER_ID}
Found agent with resource ID: ...
Created session for user ID: ...
Type 'quit' to exit.
Input: Hello, what can you do for me?
Response: Hello! I can guide you through a structured process to receive financial advice. We'll work together with a team of expert subagents to:

1.  **Analyze a market ticker**: We'll start by having you provide a Bursa Malaysia (KLSE) market ticker symbol (e.g., MAYBANK, PBBANK, 1155.KL). Our data analyst subagent will then provide a comprehensive analysis of it.
2.  **Develop trading strategies**: Based on the market analysis and your risk attitude and investment period, our trading strategist subagent will propose potential trading strategies.
3.  **Define an execution plan**: Next, our execution specialist subagent will create a detailed plan for implementing the chosen strategy, considering factors like order types and timing.
4.  **Evaluate the overall risk**: Finally, our risk analyst subagent will assess the overall risk of the financial plan, ensuring it aligns with your goals and risk tolerance.

Would you like to begin by providing a market ticker symbol for analysis?
```

To delete the deployed agent, you may run the following command:

```bash
python3 deployment/deploy.py --delete --resource_id=${AGENT_ENGINE_ID}
```

## Customization

1. Enhance Data_Analyst Module Search Capabilities with Specialized Stock Repositories:
To empower the data_analyst module with more comprehensive insights, expand its search functionality to directly access and integrate with specialized stock-related data repositories. This would involve connecting to databases, APIs, or data lakes containing real-time and historical stock prices, trading volumes, company financial statements (e.g., income statements, balance sheets, cash flow statements), news articles, analyst ratings, and potentially alternative data sources (e.g., satellite imagery for supply chain analysis, social media sentiment). The goal is to provide data analysts with a richer, more granular, and domain-specific dataset to perform in-depth market research, trend analysis, and predictive modeling.
2. Establish and Implement Diverse Analyst Personas for Tailored Access and Functionality:
Systematically define and implement a broader range of analyst personas or role-based access configurations tailored to specific analytical needs and organizational structures. This involves identifying different types of data analysts (e.g., quantitative analysts, fundamental analysts, risk analysts, compliance analysts, market researchers) and mapping their unique data access requirements, tool functionalities, and reporting needs. By assigning specific roles or personas, the system can ensure that each analyst has access only to the relevant data, tools, and features necessary for their tasks, improving security, streamlining workflows, and preventing information overload. This also allows for the customization of user interfaces and analytical dashboards to better suit the preferences and expertise of each persona.
3. Iteratively Refine Prompt Engineering for Optimal Result Precision and Relevance:
Continuously iterate on the strategies and techniques used in prompt engineering to elicit more precise, relevant, and actionable results from generative AI models or search algorithms. This process involves experimenting with various prompt structures, keywords, contextual information, examples, and constraints to guide the AI towards producing outputs that directly address the user's intent and specific information requirements. Regular feedback loops, A/B testing of different prompts, and ongoing analysis of result quality are crucial to refine the prompts. The aim is to minimize irrelevant or inaccurate information, enhance the clarity and conciseness of the outputs, and ensure that the results are consistently aligned with the analytical objectives.
